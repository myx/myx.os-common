#!/bin/sh

##### !!! This script is universal for FreeBSD, Darwin, Ubuntu. !!! #####

gitCloneSync(){
	local TGT_DIR="$1"
	[ -z "$TGT_DIR" ] && echo "lib/gitCloneSync: TGT_DIR is required!" >&2 && exit 1

	local SRC_URL="$2"
	[ -z "$SRC_URL" ] && echo "lib/gitCloneSync: SRC_URL is required!" >&2 && exit 1

	local BRANCH="$3"
	
	[ -d "$TGT_DIR" ] || ({
	    echo "$TGT_DIR: creating..."
	    mkdir -p "$TGT_DIR"
	    git clone "$SRC_URL" "$TGT_DIR"
	});
	[ -d "$TGT_DIR" ] && ({
	    cd "$TGT_DIR"
	    echo "$TGT_DIR: updating..."
	    git remote set-url origin "$SRC_URL"
	    [ -n $BRANCH ] && git checkout $BRANCH
	    git pull
	    echo "$TGT_DIR: finished."
	}) || true;
}


if [ "gitCloneSync" = "`basename $0`" ] ; then
	if [ -z "$1" ] ; then
		echo "Syntax: myx.common lib/gitCloneSync dst_path repo_url <branch>" >&2
		exit 1
	fi
	set -e
	gitCloneSync $@
fi
