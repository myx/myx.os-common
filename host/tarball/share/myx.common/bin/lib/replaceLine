#!/usr/bin/env bash

##### !!! This script is universal for FreeBSD, Darwin, Ubuntu. !!! #####

# >>>                              <<<
# >>>>>       COPIED  FROM       <<<<<
# >>>                              <<<
# > ../../include/subr-universal.sh  <
# >>>                              <<<

ReplaceLine(){
	local FL="$1" FR="$2" TO="$3"
	[ ! -z "$FL" ] || { echo "ReplaceLine: FL argument is required!" >&2 ; exit 1 ; }
	[ -f "$FL" ] || { echo "ReplaceLine: FL file is expected!" >&2 ; exit 1 ; }
	
	grep -q "$FR" $FL && \
		cp -pf "$FL" "$FL.bak" && \
		chmod 664 "$FL.bak" && \
		grep -v "$FR" "$FL.bak" > "$FL" && \
		rm "$FL.bak"
		
	grep -q -x -F "$TO" "$FL" || \
		echo "$TO" >> "$FL"
		
	return 0;
}

case "$0" in
	*/myx.common/bin/lib/replaceLine) 
		if [ -z "$1" ] ; then
			echo "Syntax: myx.common lib/replaceLine file from-regexp to-value" >&2
			exit 1
		fi
		set -e
		ReplaceLine "$@"
	;;
esac
